<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="1 创建google项目
①
打开 https://console.cloud.google.com/apis/dashboard
②
点击新建项目创建项目
③
项目名称随便取个，叫nezha完事了
④
点击创建，完成创建


2 配置OAuth
①
点击左侧的API和服务&quot; → &ldquo;OAuth权限请求页面&rdquo;">  

  <title>
    
      哪吒探针V1启用google登录
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.65ae318a1ec6e7795879f61af92fe7a407a4b2e59adeeb02b3892f4bf792ef7945c69626b1d0e0960725e3173c7d988b1ca729bac9d9c4b3e2117f20e01be3e0.css" integrity="sha512-Za4xih7G53lYefYa&#43;S/npAeksuWa3usCs4kvS/eS73lFxpYmsdDglgcl4xc8fZiLHKcpusnZxLPiEX8g4Bvj4A==" />
  
</head>
<body a="dark">
        <main class="page-content" aria-label="Content">
            <div class="w">
                <div class="post-meta">
                    <a href="/">..</a>

                    <p>
                        <time datetime="2025-01-26 18:16:50 &#43;0000 UTC">
                            2025-01-26
                        </time>
                    </p>
                </div>

<article>
    <h1>哪吒探针V1启用google登录</h1>

    

    <h1 id="1-创建google项目">1 创建google项目</h1>
<h2 id="heading">①</h2>
<p>打开 <a href="https://console.cloud.google.com/apis/dashboard">https://console.cloud.google.com/apis/dashboard</a></p>
<h2 id="heading-1">②</h2>
<p>点击新建项目创建项目</p>
<h2 id="heading-2">③</h2>
<p>项目名称随便取个，叫nezha完事了</p>
<h2 id="heading-3">④</h2>
<p>点击创建，完成创建</p>
<p><img src="https://s3.qklg.net/img/VsVrKPe.png" alt="image-20250126165956579"></p>
<p><img src="https://s3.qklg.net/img/TkX4DRg.png" alt="image-20250126170032042"></p>
<h1 id="2-配置oauth">2 配置OAuth</h1>
<h2 id="heading-4">①</h2>
<p>点击左侧的API和服务&quot; → &ldquo;OAuth权限请求页面&rdquo;</p>
<p>打开链接 <a href="https://console.cloud.google.com/apis/credentials/">https://console.cloud.google.com/apis/credentials/</a> 直达</p>
<h2 id="heading-5">②</h2>
<p>用户类型选择外部，点击创建</p>
<p><img src="https://s3.qklg.net/img/5lBCoj6.png" alt="image-20250126170651299"></p>
<h2 id="heading-6">③</h2>
<p>应用名称填写随便填写一个</p>
<p>用户支持电子邮件，选择你自己的gmail邮箱</p>
<p>应用徽标，选择一个图片传上去，</p>
<p>应用网域，填写你探针的地址，列如https://nezha.example.com</p>
<p>已获授权的网域填写你的哪吒探针的顶级域名 example.com</p>
<p>开发者信息填写你的gmail邮箱</p>
<p>保存并继续</p>
<p><img src="https://s3.qklg.net/img/vzyD6mV.png" alt="image-20250126171129732"></p>
<p><img src="https://s3.qklg.net/img/mKmS0vQ.png" alt="image-20250126171259628"></p>
<p><img src="https://s3.qklg.net/img/MKGCSgh.png" alt="image-20250126171327087"></p>
<h2 id="heading-7">④</h2>
<p>范围的话，点添加或移除范围，选择前两个就够了，保存并继续</p>
<p><img src="https://s3.qklg.net/img/oGNmo74.png" alt="image-20250126172059522"></p>
<p><img src="https://s3.qklg.net/img/BVPnDfe.png" alt="image-20250126172103409"></p>
<h2 id="heading-8">⑤</h2>
<p>测试用户</p>
<p>点击添加add users，把自己的gmail邮箱输入就ok了，保存并继续</p>
<h2 id="heading-9">⑥</h2>
<p>显示摘要，就完成了</p>
<h1 id="3-配置oauth凭据">3 配置OAuth凭据</h1>
<h2 id="heading-10">①</h2>
<p>左侧的&quot;API和服务-凭据</p>
<h2></h2>
<p>点击链接直达 <a href="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials</a></p>
<p>创建凭据-oatuth客户端id</p>
<h2 id="image-20250126172543453"><img src="https://s3.qklg.net/img/CC7NJfE.png" alt="image-20250126172543453">②</h2>
<p>选择应用类型（Web应用)</p>
<p><img src="https://s3.qklg.net/img/nMy3S5P.png" alt="image-20250126172655544"></p>
<h2 id="heading-11">③</h2>
<p>设置已获授权的 JavaScript 来源 填写你的探针域名 <a href="https://nezha.example.com">https://nezha.example.com</a></p>
<p>已获授权的重定向 URI，填写哪吒的callback地址   <a href="https://nezha.example.com/api/v1/oauth2/callback">https://nezha.example.com/api/v1/oauth2/callback</a></p>
<p>点击创建，获得</p>
<p>clientid和clientsecret</p>
<p><img src="https://s3.qklg.net/img/ytIuOSb.png" alt="image-20250126173651162"></p>
<h1 id="4-哪吒面板配置">4 哪吒面板配置</h1>
<h2 id="heading-12">①</h2>
<p>打开/opt/nezha/dashboard/data/config.yaml下加入如下</p>
<p>​    clientid和clientsecret替换上面生成的，</p>
<pre tabindex="0"><code>oauth2:
  Google:
    clientid: &#34;your id&#34;
    clientsecret: &#34;your secret&#34;
    endpoint:
      authurl: &#34;https://accounts.google.com/o/oauth2/v2/auth&#34;
      tokenurl: &#34;https://oauth2.googleapis.com/token&#34;
    scopes:
       - &#34;https://www.googleapis.com/auth/userinfo.email&#34;
    userinfourl: &#34;https://openidconnect.googleapis.com/v1/userinfo&#34;
    useridpath: &#34;sub&#34;
</code></pre><h2 id="heading-13">②</h2>
<p>重启docker</p>
<p>重启后登录 登录哪吒探针的后台，进入“个人信息”页面绑定即可。</p>
<p><img src="https://s3.qklg.net/img/R0L7KWB.png" alt="image-20250126175540357"></p>
<h2 id="heading-14">③</h2>
<p>为了安全，可以在个人信息页面，更新个人资料那边，禁用密码登录</p>
<p><img src="https://s3.qklg.net/img/YS9X7uf.png" alt="image-20250126175717060"></p>
<p>感谢以下几位大佬</p>
<p>谷歌的设置参考了https://coreychiu.com/blogs/google-oauth-setup</p>
<p>哪吒yaml文件设置参考了https://www.nodeseek.com/post-234604-1</p>
<p><a href="https://www.74110.net/tutorial/linux/nezha-v1-github-oauth2/">https://www.74110.net/tutorial/linux/nezha-v1-github-oauth2/</a></p>
<p>哪吒wiki <a href="https://nezha.wiki/guide/q14.html">https://nezha.wiki/guide/q14.html</a></p>

</article>

            </div>
        </main>
    </body></html>
